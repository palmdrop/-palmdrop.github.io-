import{isServer as C,createComponent as ge,spread as J,useAssets as ye,ssr as ve,escape as V,getRequestEvent as X}from"solid-js/web";import{createContext as F,createUniqueId as we,useContext as U,createRenderEffect as G,onCleanup as Pe,sharedConfig as xe,getOwner as be,runWithOwner as Q,createMemo as b,untrack as Y,createSignal as $,on as Z,startTransition as Re,resetErrorBoundaries as Ce,batch as Se,createComponent as Ee}from"solid-js";const ee=F(),te=["title","meta"],_=[],k=["name","http-equiv","content","charset","media"].concat(["property"]),N=(t,n)=>{const e=Object.fromEntries(Object.entries(t.props).filter(([r])=>n.includes(r)).sort());return(Object.hasOwn(e,"name")||Object.hasOwn(e,"property"))&&(e.name=e.name||e.property,delete e.property),t.tag+JSON.stringify(e)};function Oe(){if(!xe.context){const e=document.head.querySelectorAll("[data-sm]");Array.prototype.forEach.call(e,r=>r.parentNode.removeChild(r))}const t=new Map;function n(e){if(e.ref)return e.ref;let r=document.querySelector(`[data-sm="${e.id}"]`);return r?(r.tagName.toLowerCase()!==e.tag&&(r.parentNode&&r.parentNode.removeChild(r),r=document.createElement(e.tag)),r.removeAttribute("data-sm")):r=document.createElement(e.tag),r}return{addTag(e){if(te.indexOf(e.tag)!==-1){const s=e.tag==="title"?_:k,a=N(e,s);t.has(a)||t.set(a,[]);let i=t.get(a),f=i.length;i=[...i,e],t.set(a,i);let u=n(e);e.ref=u,J(u,e.props);let l=null;for(var r=f-1;r>=0;r--)if(i[r]!=null){l=i[r];break}return u.parentNode!=document.head&&document.head.appendChild(u),l&&l.ref&&l.ref.parentNode&&document.head.removeChild(l.ref),f}let o=n(e);return e.ref=o,J(o,e.props),o.parentNode!=document.head&&document.head.appendChild(o),-1},removeTag(e,r){const o=e.tag==="title"?_:k,s=N(e,o);if(e.ref){const a=t.get(s);if(a){if(e.ref.parentNode){e.ref.parentNode.removeChild(e.ref);for(let i=r-1;i>=0;i--)a[i]!=null&&document.head.appendChild(a[i].ref)}a[r]=null,t.set(s,a)}else e.ref.parentNode&&e.ref.parentNode.removeChild(e.ref)}}}}function Ae(){const t=[];return ye(()=>ve($e(t))),{addTag(n){if(te.indexOf(n.tag)!==-1){const e=n.tag==="title"?_:k,r=N(n,e),o=t.findIndex(s=>s.tag===n.tag&&N(s,e)===r);o!==-1&&t.splice(o,1)}return t.push(n),t.length},removeTag(n,e){}}}const Qe=t=>{const n=C?Ae():Oe();return ge(ee.Provider,{value:n,get children(){return t.children}})},ne=(t,n,e)=>(Te({tag:t,props:n,setting:e,id:we(),get name(){return n.name||n.property}}),null);function Te(t){const n=U(ee);if(!n)throw new Error("<MetaProvider /> should be in the tree");G(()=>{const e=n.addTag(t);Pe(()=>n.removeTag(t,e))})}function $e(t){return t.map(n=>{const r=Object.keys(n.props).map(s=>s==="children"?"":` ${s}="${V(n.props[s],!0)}"`).join("");let o=n.props.children;return Array.isArray(o)&&(o=o.join("")),n.setting?.close?`<${n.tag} data-sm="${n.id}"${r}>${n.setting?.escape?V(o):o||""}</${n.tag}>`:`<${n.tag} data-sm="${n.id}"${r}/>`}).join("")}const Ye=t=>ne("title",t,{escape:!0,close:!0}),Ze=t=>ne("meta",t);function je(){let t=new Set;function n(o){return t.add(o),()=>t.delete(o)}let e=!1;function r(o,s){if(e)return!(e=!1);const a={to:o,options:s,defaultPrevented:!1,preventDefault:()=>a.defaultPrevented=!0};for(const i of t)i.listener({...a,from:i.location,retry:f=>{f&&(e=!0),i.navigate(o,{...s,resolve:!1})}});return!a.defaultPrevented}return{subscribe:n,confirm:r}}let B;function re(){(!window.history.state||window.history.state._depth==null)&&window.history.replaceState({...window.history.state,_depth:window.history.length-1},""),B=window.history.state._depth}C||re();function et(t){return{...t,_depth:window.history.state&&window.history.state._depth}}function tt(t,n){let e=!1;return()=>{const r=B;re();const o=r==null?null:B-r;if(e){e=!1;return}o&&n(o)?(e=!0,window.history.go(-o)):t()}}const Ne=/^(?:[a-z0-9]+:)?\/\//i,Le=/^\/+|(\/)\/+$/g,Me="http://sr";function S(t,n=!1){const e=t.replace(Le,"$1");return e?n||/^[?#]/.test(e)?e:"/"+e:""}function j(t,n,e){if(Ne.test(n))return;const r=S(t),o=e&&S(e);let s="";return!o||n.startsWith("/")?s=r:o.toLowerCase().indexOf(r.toLowerCase())!==0?s=r+o:s=o,(s||"/")+S(n,!s)}function Ie(t,n){if(t==null)throw new Error(n);return t}function qe(t,n){return S(t).replace(/\/*(\*.*)?$/g,"")+S(n)}function oe(t){const n={};return t.searchParams.forEach((e,r)=>{n[r]=e}),n}function _e(t,n,e){const[r,o]=t.split("/*",2),s=r.split("/").filter(Boolean),a=s.length;return i=>{const f=i.split("/").filter(Boolean),u=f.length-a;if(u<0||u>0&&o===void 0&&!n)return null;const l={path:a?"":"/",params:{}},y=p=>e===void 0?void 0:e[p];for(let p=0;p<a;p++){const h=s[p],m=f[p],w=h[0]===":",E=w?h.slice(1):h;if(w&&I(m,y(E)))l.params[E]=m;else if(w||!I(m,h))return null;l.path+=`/${m}`}if(o){const p=u?f.slice(-u).join("/"):"";if(I(p,y(o)))l.params[o]=p;else return null}return l}}function I(t,n){const e=r=>r.localeCompare(t,void 0,{sensitivity:"base"})===0;return n===void 0?!0:typeof n=="string"?e(n):typeof n=="function"?n(t):Array.isArray(n)?n.some(e):n instanceof RegExp?n.test(t):!1}function ke(t){const[n,e]=t.pattern.split("/*",2),r=n.split("/").filter(Boolean);return r.reduce((o,s)=>o+(s.startsWith(":")?2:3),r.length-(e===void 0?0:1))}function se(t){const n=new Map,e=be();return new Proxy({},{get(r,o){return n.has(o)||Q(e,()=>n.set(o,b(()=>t()[o]))),n.get(o)()},getOwnPropertyDescriptor(){return{enumerable:!0,configurable:!0}},ownKeys(){return Reflect.ownKeys(t())}})}function Be(t,n){const e=new URLSearchParams(t);Object.entries(n).forEach(([o,s])=>{s==null||s===""?e.delete(o):e.set(o,String(s))});const r=e.toString();return r?`?${r}`:""}function ae(t){let n=/(\/?\:[^\/]+)\?/.exec(t);if(!n)return[t];let e=t.slice(0,n.index),r=t.slice(n.index+n[0].length);const o=[e,e+=n[1]];for(;n=/^(\/\:[^\/]+)\?/.exec(r);)o.push(e+=n[1]),r=r.slice(n[0].length);return ae(r).reduce((s,a)=>[...s,...o.map(i=>i+a)],[])}const Fe=100,Ue=F(),Ke=F(),ie=()=>Ie(U(Ue),"<A> and 'use' router primitives can be only used inside a Route."),We=()=>ie().navigatorFactory(),De=()=>ie().location,nt=()=>{const t=De(),n=We(),e=(r,o)=>{const s=Y(()=>t.pathname+Be(t.search,r)+t.hash);n(s,{scroll:!1,resolve:!1,...o})};return[t.query,e]};function ze(t,n=""){const{component:e,preload:r,load:o,children:s,info:a}=t,i=!s||Array.isArray(s)&&!s.length,f={key:t,component:e,preload:r||o,info:a};return ce(t.path).reduce((u,l)=>{for(const y of ae(l)){const p=qe(n,y);let h=i?p:p.split("/*",1)[0];h=h.split("/").map(m=>m.startsWith(":")||m.startsWith("*")?m:encodeURIComponent(m)).join("/"),u.push({...f,originalPath:l,pattern:h,matcher:_e(h,!i,t.matchFilters)})}return u},[])}function He(t,n=0){return{routes:t,score:ke(t[t.length-1])*1e4-n,matcher(e){const r=[];for(let o=t.length-1;o>=0;o--){const s=t[o],a=s.matcher(e);if(!a)return null;r.unshift({...a,route:s})}return r}}}function ce(t){return Array.isArray(t)?t:[t]}function Je(t,n="",e=[],r=[]){const o=ce(t);for(let s=0,a=o.length;s<a;s++){const i=o[s];if(i&&typeof i=="object"){i.hasOwnProperty("path")||(i.path="");const f=ze(i,n);for(const u of f){e.push(u);const l=Array.isArray(i.children)&&i.children.length===0;if(i.children&&!l)Je(i.children,u.pattern,e,r);else{const y=He([...e],r.length);r.push(y)}e.pop()}}}return e.length?r:r.sort((s,a)=>a.score-s.score)}function q(t,n){for(let e=0,r=t.length;e<r;e++){const o=t[e].matcher(n);if(o)return o}return[]}function Ve(t,n){const e=new URL(Me),r=b(f=>{const u=t();try{return new URL(u,e)}catch{return console.error(`Invalid path ${u}`),f}},e,{equals:(f,u)=>f.href===u.href}),o=b(()=>r().pathname),s=b(()=>r().search,!0),a=b(()=>r().hash),i=()=>"";return{get pathname(){return o()},get search(){return s()},get hash(){return a()},get state(){return n()},get key(){return i()},query:se(Z(s,()=>oe(r())))}}let x;function rt(){return x}function ot(t,n,e,r={}){const{signal:[o,s],utils:a={}}=t,i=a.parsePath||(c=>c),f=a.renderPath||(c=>c),u=a.beforeLeave||je(),l=j("",r.base||"");if(l===void 0)throw new Error(`${l} is not a valid base path`);l&&!o().value&&s({value:l,replace:!0,scroll:!1});const[y,p]=$(!1);let h;const m=(c,d)=>{d.value===w()&&d.state===O()||(h===void 0&&p(!0),x=c,h=d,Re(()=>{h===d&&(E(h.value),le(h.state),Ce(),C||K[1]([]))}).finally(()=>{h===d&&Se(()=>{x=void 0,c==="navigate"&&he(h),p(!1),h=void 0})}))},[w,E]=$(o().value),[O,le]=$(o().state),L=Ve(w,O),A=[],K=$(C?me():[]),W=b(()=>typeof r.transformUrl=="function"?q(n(),r.transformUrl(L.pathname)):q(n(),L.pathname)),ue=se(()=>{const c=W(),d={};for(let g=0;g<c.length;g++)Object.assign(d,c[g].params);return d}),D={pattern:l,path:()=>l,outlet:()=>null,resolvePath(c){return j(l,c)}};return G(Z(o,c=>m("native",c),{defer:!0})),{base:D,location:L,params:ue,isRouting:y,renderPath:f,parsePath:i,navigatorFactory:de,matches:W,beforeLeave:u,preloadRoute:pe,singleFlight:r.singleFlight===void 0?!0:r.singleFlight,submissions:K};function fe(c,d,g){Y(()=>{if(typeof d=="number"){d&&(a.go?a.go(d):console.warn("Router integration does not support relative routing"));return}const{replace:T,resolve:M,scroll:P,state:R}={replace:!1,resolve:!0,scroll:!0,...g},v=M?c.resolvePath(d):j("",d);if(v===void 0)throw new Error(`Path '${d}' is not a routable path`);if(A.length>=Fe)throw new Error("Too many redirects");const z=w();if(v!==z||R!==O())if(C){const H=X();H&&(H.response={status:302,headers:new Headers({Location:v})}),s({value:v,replace:T,scroll:P,state:R})}else u.confirm(v,g)&&(A.push({value:z,replace:T,scroll:P,state:O()}),m("navigate",{value:v,state:R}))})}function de(c){return c=c||U(Ke)||D,(d,g)=>fe(c,d,g)}function he(c){const d=A[0];d&&(s({...c,replace:d.replace,scroll:d.scroll}),A.length=0)}function pe(c,d={}){const g=q(n(),c.pathname),T=x;x="preload";for(let M in g){const{route:P,params:R}=g[M];P.component&&P.component.preload&&P.component.preload();const{preload:v}=P;d.preloadData&&v&&Q(e(),()=>v({params:R,location:{pathname:c.pathname,search:c.search,hash:c.hash,query:oe(c),state:null,key:""},intent:"preload"}))}x=T}function me(){const c=X();return c&&c.router&&c.router.submission?[c.router.submission]:[]}}function st(t,n,e,r){const{base:o,location:s,params:a}=t,{pattern:i,component:f,preload:u}=r().route,l=b(()=>r().path);f&&f.preload&&f.preload();const y=u?u({params:a,location:s,intent:x||"initial"}):void 0;return{parent:n,pattern:i,path:l,outlet:()=>f?Ee(f,{params:a,location:s,data:y,get children(){return e()}}):e(),resolvePath(h){return j(o.path(),h,l())}}}const at="Nära och långt från kroppen",it="Experimentell poesi, nära och långt från kroppen";export{at as A,Qe as M,Ue as R,Ye as T,ot as a,st as b,Je as c,Ke as d,rt as e,je as f,q as g,Ze as h,it as i,et as k,Me as m,tt as n,re as s,nt as u};
