<!DOCTYPE html>
<html lang="en-us">
<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "https:\/\/palmdrop.github.io"
        },
        "articleSection" : "post",
        "name" : "My take on domain warping",
        "headline" : "My take on domain warping",
        "description" : "\u003cp\u003eDomain warping: a procedural method for generating natural-looking patterns and shapes. I\u0026rsquo;ve used this technique for a long time, and the results can be beautiful and strangely organic. This post will explore my (slightly different) approach, and some of the images this approached helped produce.\u003c\/p\u003e",
        "inLanguage" : "en",
        "author" : "",
        "creator" : "",
        "publisher": "",
        "accountablePerson" : "",
        "copyrightHolder" : "",
        "copyrightYear" : "2021",
        "datePublished": "2021-01-24 18:25:22 \u002b0100 CET",
        "dateModified" : "2021-01-24 18:25:22 \u002b0100 CET",
        "url" : "https:\/\/palmdrop.github.io\/post\/domain-warping\/",
        "wordCount" : "1070",
        "image" : "https://palmdrop.github.ioimg/dw/banner.png"",
        "keywords" : [ ""noise"",""graphics"",""procedural"",""domain-warping"","Blog" ]   
    }
    </script>


 <title>My take on domain warping </title>


<meta name="description" content="Personal blog for sharing procedural techniques, thoughts and data experiments." />



<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="robots" content="all,follow">
<meta name="googlebot" content="index,follow,snippet,archive">
<link rel="stylesheet" id="ct-tracks-google-fonts-css" href="https://fonts.googleapis.com/css?family=Raleway%3A400%2C700&amp;subset=latin%2Clatin-ext&amp;ver=4.7.2" type="text/css" media="all">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">

<link href="https://palmdrop.github.io/css/style.css?v=1622235841" rel="stylesheet" id="theme-stylesheet" type='text/css' media='all'>

<link href="https://palmdrop.github.io/css/custom.css?v=1622235841" rel="stylesheet" type='text/css' media='all'>
<link rel="shortcut icon" href="https://palmdrop.github.io/img/favicon.ico" type="image/x-icon">
<link rel="icon" href="https://palmdrop.github.io/img/favicon.ico" type="image/x-icon">


</head>


<body class="post-template-default single single-post single-format-standard ct-body singular singular-post not-front standard">

  <div id="overflow-container" class="overflow-container">
    <a class="skip-content" href="#main">Skip to content</a>
    <header id="site-header" class="site-header" role="banner">
      <div class='top-navigation'>
        <div class='container'>

  <div id="menu-secondary" class="menu-container menu-secondary" role="navigation">
    <button id="toggle-secondary-navigation" class="toggle-secondary-navigation"><i class="fas fa-plus"></i></button>

    <div class="menu">

      <ul id="menu-secondary-items" class="menu-secondary-items">
        
        <li class="menu-item menu-item-type-taxonomy menu-item-object-category">
          <a href="/categories/generative">generative</a>
        </li>
        

      </ul>

    </div>

  </div>


  <ul class="social-media-icons">


    

    

    

    
    <li>
      <a href="https://www.instagram.com/palmdrop/" data-animate-hover="pulse" class="instagram" target="_blank">
        <i class="fab fa-instagram" title="instagram"></i>
        <span class="screen-reader-text">instagram</span>
      </a>
    </li>
    

    
    <li>
      <a href="mailto:anton@exlex.se" data-animate-hover="pulse" class="email">
        <i class="fas fa-envelope" title="email"></i>
        <span class="screen-reader-text">email</span>
      </a>
    </li>
    

    

    


    
    <li>
      <a href="https://github.com/palmdrop" data-animate-hover="pulse" class="github" target="_blank">
        <i class="fab fa-github" title="github"></i>
        <span class="screen-reader-text">github</span>
      </a>
    </li>
    


    

    
    <li>
      <a href="https://palmdrop.github.io/index.xml" data-animate-hover="pulse" class="rss" target="_blank">
        <i class="fas fa-rss" title="rss"></i>
        <span class="screen-reader-text">rss</span>
      </a>
    </li>
    


  </ul></div>

      </div>

      <div class="container">
        <div id="title-info" class="title-info">
  <div id='site-title' class='site-title'>
    
    <a href="/"> Palmdrop </a>
    </div>
  </div>
  <button id="toggle-navigation" class="toggle-navigation">
    <i class="fas fa-bars"></i>
  </button>

  <div id="menu-primary-tracks" class="menu-primary-tracks"></div>
  <div id="menu-primary" class="menu-container menu-primary" role="navigation">
    
    <p class="site-description">Generative art and data experiements</p>
    

    <div class="menu">
      <ul id="menu-primary-items" class="menu-primary-items">
        
        
        <li class='menu-item menu-item-type-custom menu-item-object-custom '>
          <a href="https://palmdrop.github.io/">Posts</a>
          
        </li>
        
        <li class='menu-item menu-item-type-post_type menu-item-object-page '>
          <a href="https://palmdrop.github.io/about/">About</a>
          
        </li>
        
        <li class='menu-item menu-item-type-post_type menu-item-object-page '>
          <a href="https://palmdrop.github.io/surfaces/">Surfaces</a>
          
        </li>
        
      </ul>
    </div>

  </div>

      </div>
    </header>

    <div id="main" class="main" role="main">

      
  
  
    
  
  
  <div id="loop-container" class="loop-container">
    
    <div class="post type-post status-publish format-standard has-post-thumbnail hentry category-design tag-design tag-standard-2 tag-tagalicious tag-travel entry full-without-featured odd excerpt-1">

      <div class='featured-image lazy lazy-bg-image'  data-background="https://palmdrop.github.io/img/dw/banner.png">
      </div>
      
        <div class="entry-meta">
          

		  


          


        </div>
        <div class='entry-header'>
          <h1 class='entry-title'> My take on domain warping</h1>
        </div>
        <div class="entry-container">
          <div class="entry-content">
            <article>
              <p>Domain warping: a procedural method for generating natural-looking patterns and shapes. I&rsquo;ve used this technique for a long time, and the results can be beautiful and strangely organic. This post will explore my (slightly different) approach, and some of the images this approached helped produce.</p>
<p>The traditional implementation of domain warping is introduced perfectly by Inigo Quilez in <a href="https://www.iquilezles.org/www/articles/warp/warp.htm">this</a> blog post. Here&rsquo;s my summary:</p>
<p>A domain is the set of all possible input alues for a particular function. When we warp a domain, each input value is mapped to some other input value, before being passed to the function. E.g, we warp the domain of <code>f(x)</code> by inserting another function <code>g(x)</code> like this: <code>f(g(x))</code>. For math heads, this is just function composition, but when this operation is performed in order to deform a 2D or 3D graphical scene or object, the term domain warping is often used instead. It&rsquo;s more descriptive; spatial warping is what we do.</p>
<p>I mostly work in two dimensions. <code>x</code> then becomes <code>p</code>, a two-dimensional point. <code>f(p)</code> is a function that takes a point and returns a floating-point value, and <code>g(x)</code> is a function which takes a point and returns a new, transformed point.</p>
<p>Here&rsquo;s a spiral pattern I made using a sawtooth wave (<code>f(p)</code>) and a warping function that rotates each input point around origo (<code>g(p)</code>).</p>
<p><img src="/img/dw/simple1.png" alt="spiral"></p>
<p>Possibly hypnotic. If I didn&rsquo;t want you to keep reading I would have made it spin as well.</p>
<p>Moving on, let&rsquo;s consider my implementation of domain warping. It&rsquo;s not that different from the traditional method, however, I strictly work with polar offsets (an angle and a distance) to transform my points, instead of defining an x and y offset separately.</p>
<p>As Inigo Quilez describes, we often only want to warp the domain with a small amount. If the point <code>p</code> is the non-warped input to a function <code>f(p)</code>, we might define our warping function like this: <code>g(p) = p + h(p)</code> where <code>h(p)</code> returns a small offset. Instead of this, I use two functions <code>A(p)</code> and <code>D(p)</code> to define an angle and a distance which I use to calculate a polar offset. We get:</p>
<pre><code>g(p) = p + [cos(A(p)), sin(A(p))] * D(p)
</code></pre>
<p>where <code>[x, y]</code> is a two-dimensional point.</p>
<p>This allows me to define different functions for <code>A(p)</code> and <code>D(p)</code>, which often produces interesting results. This method makes the x and y values of the offset fairly coherent across space and gives me a lot of control. It also makes it trivial to vary the strength of the warping effect across space (make sure <code>D(p)</code> is a low value for some areas) or control the intensity of the distortions, i.e, how detailed the warp is (by tuning the frequency of <code>A(p)</code>).</p>
<p>When working with this method, I often use simple mathematical functions in combination with noise functions (like Perlin noise). It&rsquo;s helpful to make sure all these functions return values between 0 and 1, to know what we are working with. To get an angle or a distance outside the range of [0,1], just multiply the result of <code>D(p)</code> and/or <code>A(p)</code>.</p>
<p>Perhaps all this will be more clear with some pseudo-code:</p>
<pre><code>domainWarp(p, angleFunction, distFunction, maxDist) 
    angle = angleFunction(p) * TWO_PI
    distance = distFunction(p) * maxDist

    offset = vec2(cos(angle), sin(angle)) * distance

    return p + offset
</code></pre>
<p>If <code>angleFunction</code> and <code>distFunction</code> only return values between 0 and 1, the angle will be between 0 and two times <em>pi</em> (radians), and the distance will be between 0 and <code>maxDist</code>. Using three different noise functions, <code>N1</code>, <code>N2</code> and <code>N3</code>, let&rsquo;s try this out:</p>
<pre><code>N1(domainWarp(p, N2, N3, maxDist))
</code></pre>
<p>We have now warped the domain of <code>N1</code> using polar offsets with a max distance of <code>maxDist</code>.</p>
<p>Here&rsquo;s another image produced with this method. <code>N1</code> is a sine function, <code>N2</code> is a noise function with a high frequency and <code>N3</code> is a noise function with a low frequency.</p>
<p><img src="/img/dw/simple2.png" alt="Domain warp 1"></p>
<p>Some areas are less intense, and in these areas, the sine wave is still apparent, but it&rsquo;s been transformed to a curled and folded string. Here, the waveform remains continuous because the noise functions used are fairly smooth. The curl effect is created thanks to the use of polar offsets. However, when the effect becomes more intense (<code>D(p)</code> takes on a higher value), the sine wave is transfigured &ndash; it becomes a mess of alien-like scribbles. The overall effect is quite organic, and to me, a lot more visually engaging than plain noise.</p>
<p>Generally, the best (and most strange) results were achieved when I used a combination of noise and other mathematical functions. In a future post, I&rsquo;ll document some of these combinations.</p>
<p>But for now, I&rsquo;d like to mention two personal breakthroughs. First, I realized that you could use a function to warp its own domain. Take noise function <code>N</code>, and define a new, warped noise function as follows:</p>
<pre><code>N'(p) = N(domainWarp(p, N, N, maxDist))
</code></pre>
<p>Here, <code>N</code> itself determines how much its domain should be warped (both in terms of angle and distance). A feedback effect is achieved, which made me think: why only do this for one iteration? This is the second breakthrough. Why not do this recursively?</p>
<p>So, by going another step we get:</p>
<pre><code>N''(p) = N(domainWarp(p, N', N', maxDist))
</code></pre>
<p>There are endless variations to this. You might want to use <code>N'</code> as the noise being warped for the second iteration. You might also not want to keep using <code>N</code> as the only noise source: other functions can be introduced and applied in any way you might like.</p>
<p>Here are a few more images produced with variations of this technique:</p>
<p><img src="/img/dw/recursive2.png" alt="recursive 2"></p>
<p>Many layers of noise and domain warping are here combined, and color is introduced.</p>
<p><img src="/img/dw/recursive3.png" alt="recursive 3"></p>
<p>I do not even remember what&rsquo;s going on here.</p>
<p><img src="/img/dw/recursive1.png" alt="recursive 1"></p>
<p>And these &ldquo;glass pearls&rdquo; are particularly interesting to me. No physics simulations are going on here, no light interactions. The basic pattern is just a sine function combined with some low-frequency Perlin noise. The domain of this pattern is then warped using a grid of fuzzy circles (brighter close to their centers, darker close to the edges). With a few recursions, the sine wave is rotated and scaled multiple times, and hence seem to adopt the shape of the &ldquo;pearls&rdquo;.</p>
<p>In a future post, I&rsquo;ll describe some more of my results. By introducing fractal noise (sometimes called fractal Brownian motion), ridged noise, and more complex function interactions, I rendered images that looked like photographs of microscopic beings or extraterrestrial terrains.</p>
<p>More soon.</p>
            </article>
          </div>
          
      <div class='entry-meta-bottom'>
        

  <div class="entry-categories"><p><span>Categories</span>
    
    <a href="/categories/generative" title="View all posts in Generative">Generative</a>
  </p>
</div>



<div class="entry-tags"><p><span>Tags</span>
  
  <a href="/tags/noise" title="View all posts tagged noise">noise</a>
  
  <a href="/tags/graphics" title="View all posts tagged graphics">graphics</a>
  
  <a href="/tags/procedural" title="View all posts tagged procedural">procedural</a>
  
  <a href="/tags/domain-warping" title="View all posts tagged domain-warping">domain-warping</a>
  

</p></div>	</div>

	
</div>
</div>

<section id="comments" class="comments">
  

  




</section>
</div>

 



    </div>

    <footer id="site-footer" class="site-footer" role="contentinfo">
	<h1>
    
    <a href=""> Palmdrop </a>
    
	</h1>

			
			<p class="site-description">Generative art and data experiements</p>
			

		<div id="menu-footer" class="menu-container menu-footer" role="navigation">
		<div class="menu">

      <ul id="menu-footer-items" class="menu-footer-items">
        
</ul>

</div>	</div>

<ul class="social-media-icons">

        

        


        

        
        <li>
        <a href="https://www.instagram.com/palmdrop/"  class="instagram" target="_blank">
            <i class="fab fa-instagram" title="instagram"></i>
            <span class="screen-reader-text">instagram</span>
        </a>
        </li>
        

        
        <li>
        <a href="mailto:anton@exlex.se"  class="email">
            <i class="fas fa-envelope" title="email"></i>
            <span class="screen-reader-text">email</span>
        </a>
        </li>
        

        

        


        
        <li>
        <a href="https://github.com/palmdrop"  class="github" target="_blank">
            <i class="fab fa-github" title="github"></i>
            <span class="screen-reader-text">github</span>
        </a>
        </li>
        


        

        
        <li>
        <a href="https://palmdrop.github.io/index.xml" data-animate-hover="pulse" class="rss" target="_blank">
            <i class="fas fa-rss" title="rss"></i>
            <span class="screen-reader-text">rss</span>
        </a>
        </li>
        

        
	</div>
</footer>

  </div>
  <script src="https://palmdrop.github.io/js/jquery.min.js"></script>
<script src="https://palmdrop.github.io/js/jquerymigrate.js"></script>
<script src="https://palmdrop.github.io/js/production.min.js?v=1622235841"></script>

</body>
</html>
